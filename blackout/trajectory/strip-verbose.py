#!/usr/bin/env python

# Usage: python strip-verbose.py input_trajectory [output_trajectory]

# Input file is assumed to be a trajectory file, generated by one of the engine*.py scripts with the --verbose option.
# Output will be the same trajectory, but with all :action-failed, :undo, and :redo lines and their associated states erased,
#   exactly as if the engine script was invoked without the --verbose option.
# If no output file name is given, then the output will be printed to standard output.

import sys

#keywords


in_fname  = sys.argv[1]

prefix = []
data = []

ignore_lines = 0

with open(in_fname, 'r') as fin:
    for line in fin:
        if line == '\n':
            pass
        elif ignore_lines > 0:
            ignore_lines -= 1
        elif line.startswith('(:action-failed'):
            ignore_lines = 1
        elif line.startswith('(:undo'):
            data.pop()
            data.pop()
            ignore_lines = 1
        elif line.startswith('(:restart'):
            data = []
            ignore_lines = 1
        elif line.startswith(('(trajectory', '(:objects', '(:init')):
            prefix.append(line)
        else:
            data.append(line)


if len(sys.argv) > 2:
    fout = open(sys.argv[2], 'w')
else:
    fout = sys.stdout

fout.write('\n'.join(prefix))
fout.write('\n')
fout.write('\n'.join(data))

fout.close()





